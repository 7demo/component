#!/usr/bin/env node

var open = require('open');
var program = require('commander');
var Component = require('..');
var logger = Component.logger;
var normalize = Component.normalize.json;

/**
 * Help.
 */

program.on('--help', function(){
  console.log('  Opens the relevant webpage in your favorite browser.')
  console.log();
  console.log('  Commands:');
  console.log();
  console.log('    open                    opens http://component.io');
  console.log('    open guide              opens the guide to Component');
  console.log('    open troubleshooting    opens the troubleshooting docs');
  console.log('    open help               opens the component(1) API docs');
  console.log('    open help <command>     opens the docs to a specific component(1) command');
  console.log('    open .                  opens the current component\'s github page');
  console.log('    open <repo>             opens <repo>\'s github page');
  console.log();
  process.exit();
});

/**
 * Parse.
 */

program.parse(process.argv);

/**
 * Open.
 */

switch (program.args[0]) {
  case undefined:
    return open('http://component.io/');

  case 'guide':
    return open('https://github.com/component/guide');

  case 'troubleshoot':
  case 'troubleshooting':
    return open('https://github.com/component/guide/blob/master/component/troubleshooting.md');

  case 'help':
    var uri = 'https://github.com/component/guide/blob/master/component/api.md';
    if (program.args[1]) uri += '#' + program.args[1];
    return open(uri);

  case '.':
    try {
      var component = new Component(process.cwd());
    } catch (e) {
      logger.fatal(e);
    }
    var json = normalize(component.json);
    var repo = json.repository;
    if (!repo) logger.fatal('The component.json does not have a repository field.');
    program.args[0] = component.json.repository;
  default:
    open('https://github.com/' + program.args[0]);
}