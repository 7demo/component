#!/usr/bin/env node

/**
 * Module dependencies.
 */

var program = require('commander')
  , component = require('..')
  , utils = component.utils
  , cols = process.stdout.columns || 80;

// parse argv

program
  .usage('[query]')
  .parse(process.argv);

// query

var query = program.args.join(' ');

// search

component.search(query, function(err, pkgs){
  if (err) utils.fatal(err.message);
  if (!pkgs.length) return;
  console.log();
  pkgs.forEach(function(pkg){
    if (!pkg) return;
    var repo = ' \033[0;1m—\033[0;90m ' + pkg.repo.toLowerCase();
    var str = truncate(pkg.description.toLowerCase(), repo);
    utils.log(pkg.name, str + repo);
  });
  console.log();
});

/**
 * Truncate the string if necessary.
 */

function truncate(str, repo) {
  var pad = 30 + repo.length;
  if (str.length < cols - pad) return str;
  return str.slice(0, cols - pad) + '…';
}