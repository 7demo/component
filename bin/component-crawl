#!/usr/bin/env node

var program = require('commander');
var request = require('superagent');
var Component = require('..');
var logger = require('../lib/logger');

/**
 * Usage.
 */

program
  .usage('<user|organization>...')
  .parse(process.argv);

/**
 * Settings.
 */

var users = program.args;
var endpoint = 'http://component-crawler.herokuapp.com/';

if (!users.length) logger.fatal('A GitHub <user> or <organization> is required.');

/**
 * Crawl.
 */

users.forEach(function(user){
  request
    .patch(endpoint + user)
    .end(function (err, res) {
      if (err) logger.fatal(err);
      if (!res.ok) logger.fatal('Failed to crawl "' + user + '".');
      logger.log('Crawling ' + user + '...');
    });
});